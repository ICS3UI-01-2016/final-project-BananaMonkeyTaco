; Whenever someone joins the chat
on *:join:%channel: {
  ; Don't do anything if the user is a bot
  if ($nick == bananamtbot || $nick == revlobot || $nick == nightbot) {
    ; Do nothing
    return
  }
  else {
    ; Activates the timer "timerpoints.User"
    ; This timer will call the alias(method) regularPoints every 60 seconds
    ; This also sends the user as a variable for the method
    $+(timerpoints.,$nick) 0 60 regularPoints $nick
    ; Activates the timer "timerleadboard.User"
    ; Same as the above timer, will explain more in the method itself 
    $+(timerleaderboard.,$nick) 0 60 leaderboardPoints $nick
    ; This sends a message to the window, not the chat
    echo 12 -at $nick joined and is receiving %points
  }
}
; Whenever someone leaves the chat
on *:part:%channel:{
  ; No if statements to exclude anyone because mIRC can turn off timers that don't exist
  ; Turn off the timer "timerpoints.User"
  $+(timerpoints.,$nick) off
  ; Turn off the timer "timerleaderboard.User"
  $+(timerleaderboard.,$nick) off
  ; Send a message to the window
  echo 12 -at $nick has left and is no long receiving %points
}
; Used to give a user one more point
alias -l regularPoints {
  
  ; ONLY EXPLAINING THIS ONCE PAY ATTENTION
  ; Use the n switch (-n) to make sure mIRC doesn't look at the ini in computer language
  ; The location to write to is the ini, topic, item, value
  ; The new value is the calculation of the previous value plus 1
  ; The old value is found with the $readini which functions like the writeini but returns instead of edits
  
  ; Add one point to the user's previous points
  ; $1 is the variable received from the timer
  writeini -n %ini %points $1 $calc($readini(%ini,%points,$1)+1)
}
; User to give a user one more point to the leaderboard
; This is different from the basic points in that no points are taken away from this ini
; This ini shows only how much time a user has spent in the chat
alias -l leaderboardPoints {
  ;Add one more point to the user's previous points
  writeini -n Leaderboard.ini %points $1 $calc($readini(Leaderboard.ini,%points,$1)+1)
}
; Alias used when a user does not respond to a duel for one minute
alias -l cancelduel {
  ; Tell the chat that the duelee did not respond
  msg %channel %duelee has run out of time to accept the challenge from %dueler and must now live in extreme shame.
  ; Reset the variables to prevent any errors later
  %dueler = null
  %duelee = null
  %stakes = null
}
; Alias used to sort the ini files by user with the most points to the user with the least points
alias inisort {
  ; Create 4 windows
  window @sortPointsIn
  window @sortPointsOut
  window @sortLeaderboardIn
  window @sortLeaderboardOut
  ; Load the Basic ini into the sortPointsIn window
  loadbuf -t @sortPointsIn %ini
  ; Clear the sortPointsOut window and filter everything in the sortPointsIn window into the sortPointsOut window
  ; The -t switch sorts everything, the -e switch makes it sort in descending order, and the -u switch makes the sort numerical
  ; The two numbers seperates each user and their points by the equals sign. The equals sign is character 61 in ASCII
  ; The user's points is the 2nd value in a line when a "value" is seperated by the equals sign. User=Points. Value one "User" Value two "Points"
  filter -cteu 2 61 @sortPointsIn @sortPointsOut
  ; Next two lines are the same thing but for the leaderboard ini file
  loadbuf -t @sortLeaderboardIn Leaderboard.ini
  filter -cteu 2 61 @sortLeaderboardIn @sortLeaderboardOut
  ; Because the sorting was numerical the topic [Points] was sorted to the bottom, making all values under no topic
  ; To fix this we readd the topic to the top of the sorted windows
  iline @sortPointsOut 1 [Bananas]
  iline @sortLeaderboardOut 1 [Bananas]
  ; Because the ini file has not actually been sorted we need to clear it out by deleting the topic
  remini %ini Bananas
  ; Save what is in the sorted window to the ini file
  savebuf -a @sortPointsOut %ini
  ; Same thign but for the leaderboard ini file
  remini Leaderboard.ini Bananas
  savebuf -a @sortLeaderboardOut Leaderboard.ini
  ; Close the unneeded windows
  window -c @sortPointsIn
  window -c @sortPointsOut
  window -c @sortLeaderboardIn
  window -c @sortLeaderboardOut
}
; Command for a user requesting how many points they have
on *:text:!bananas:%channel: {
  ; Message the channel 
  msg $chan $nick has $readini(%ini,%points,$nick) %points
  ; Message the window what happened
  echo 12 -t $nick requested amount of %points
}
; Command to give a user points without having to edit the ini file manually
; Activated if the chat message BEGINS with !givebananas
on *:text:!givebananas*:%channel: {
  ; Check to see if the user is an op in the channel
  if ($nick isop %channel) {
    ; Make sure that there are 3 seperate values
    if ($0 == 3) {
      ; Make sure the 3rd value is a number
      if ($3 isnum) {
        ; Give the amount of points specified (3rd value/$3) to the user specified (2nd value/$2)
        ; Both positive and negative numbers will work
        writeini -n %ini %points $2 $calc($readini(%ini,%points,$2)+ $3)
        ; Send a message to the chat showing the user receiving point
        msg $chan $2 has been given $3 %points
      }
      ; If the 3rd value isn't a number
      else {
        ; Say that a number is needed
        msg $chan You must give a number to give.
      }
    }
    ; If 3 values aren't given
    else if ($0 != 3) {
      ; Say that 3 values/words are needed
      msg $chan Error. Command requires 3 words. !givebananas, Name, Number of %points to give.
    }
  }
  ; If the user isn't an op/mod in the channel
  else {
    ; Tell the user to get lost
    msg $chan This command is for mods only.
  }
}
; Command for unfinshed info doc about the bot
on *:text:!info:%channel: {
  msg $chan For information about me check out this Google Doc: https://docs.google.com/document/d/1qJfsyScG3XepkhOqKGcETzF7QLC9hV876QphGW2woU8/edit?usp=sharing
}
; Command for sorting the ini files
on *:text:!sort:%channel: {
  ; Check to see if the user is the Great Almighty
  if ($nick == bananamonkeytaco) {
    ; Call the inisort method
    $inisort
  }
}
; Command for the great evil that everyone does anyways
on *:text:!gamble*:%channel: {
  ; If 2 values aren't given
  if ($0 != 2) {
    ; Tell the user he's had too much to drink and to stop gambling
    msg $chan Error. Gamble command requires !gamble and a number.
  }
  ; If the value to be gambled is more than 1000
  else if ($2 > 1000) {
    ; Tell the user that he shouldn't gamble his kid's college fund
    msg $chan You cannot gamble more than 1000 %points
  }
  ; If everything checks out
  else {
    ; Make a random number in between/including 1 - 100
    %num = $rand(1,100)
    ; If the number rolled is more than 60
    if (%num > 60) {
      ; Tell the chat and user what he rolled and that he won his points (doubled)
      msg $chan $nick has rolled %num and won $2 %points
      ; Go to the BASIC ini file and give the user the points he won
      writeini -n %ini %points $nick $calc($readini(%ini,%points,$nick)+ $2)
    }
    ; If the number rolled is 60 or less
    else if (%num <= 60) {
      ; Tell the user what he rolled and the sad news
      msg $chan $nick has rolled %num and lost $2 %points
      ; Go to the BASIC ini file and take away the points the user lost
      writeini -n %ini %points $nick $calc($readini(%ini,%points,$nick)- $2)
    }
  }
}
; Command for the 
on *:text:!duel*:%channel: {
  if ($0 = 3) {
    if (%dueler == null) {
      if ($3 > 1000) {
        msg $chan Sorry but gambling over 1000 %points is not allowed.
      }
      else {
        msg $chan $nick has challenged $1 to a duel worth $3 %points ! $1 do you accept or decline this duel?
        %dueler = $nick
        %duelee = $2
        %stakes = $3
        timerduel 1 60 cancelduel
      }
    }
    else {
      msg $chan Sorry, but there is already a duel that has been started. Please wait until that duel expires before requesting another.
    }
  }
  else if ($0 != 3) {
    msg $chan Error. This command requires 3 words. !duel, Name, Number of %points to bet.
  }
}
on *:text:!accept:%channel: {
  if (%duelee == $nick) {
    timerduel off
    msg $chan %duelee has accepted the duel from %dueler for %stakes %points . It's time to ROLL!
    %duelerRoll = $rand(1,100)
    %dueleeRoll = $rand(1,100)
    writeini -n %ini %points %dueler $calc($readini(%ini,%points,%dueler)-%stakes)
    writeini -n %ini %points %duelee $calc($readini(%ini,%points,%duelee)-%stakes)
    msg $chan %dueler started the duel and rolls first. He rolls a %duelerRoll now let's wait and see what %duelee will roll.
    msg $chan %duelee rolls a $rand(1,100)
    if (%duelerRoll > %dueleeRoll) {
      msg $chan %dueler has won the duel and won $calc(%stakes * 2)
      writeini -n %ini %points %dueler $calc($readini(%ini,%points,%dueler)+$calc(%stakes * 2))
    }
    else if (%dueleeRoll > %duelerRoll) {
      msg $chan %duelee has won the duel and won $calc(%stakes * 2)
      writeini -n %ini %points %duelee $calc($readini(%ini,%points,%duelee)+$calc(%stakes * 2))
    } 
    else if (%dueleeRoll == %duelerRoll) {
      msg $chan Both %duelee and %dueler rolled %duelerrRoll so neither has won the duel.
      writeini -n %ini %points %dueler $calc($readini(%ini,%points,%dueler)+%stakes)
      writeini -n %ini %points %duelee $calc($readini(%ini,%points,%duelee)+%stakes)
    }
    %duelee = null
    %dueler = null
    %stakes = null
    %dueleeRoll = null
    %duelerRoll = null
  }
}
on *:text:!decline:%channel: {
  if (%duelee == $nick) {
    timerduel off
    msg $chan %duelee has declined the duel from %dueler and must live in dishonor forever.
    %duelee = null
    %dueler = null
    %stakes = null
  }
}
on *:text:!rank*:%channel: {
  if ($0 = 1) {
    window @rank
    loadbuf -t @rank %ini
    dline @rank 1
    filter -cnteu 2 61 @rank @rank
    filter -c @rank @rank $+(*,$nick,*)
    %rank = $gettok($line(@rank,1),1,32)
    window -c @rank
    msg $chan $nick is %rank on the leaderboard for current %points
  }
  else if ($0 = 2) {
    if ($2 !isnum) {
      window @rank
      loadbuf -t @rank %ini
      dline @rank 1
      filter -cnteu 2 61 @rank @rank
      filter -c @rank @rank $+(*,$2,*)
      %rank = $gettok($line(@rank,1),1,32)
      window -c @rank
      msg $chan $2 is %rank on the leaderboard for current %points
    }
    else if ($2 isnum) {
      window @rank
      window @newrank
      loadbuf -t @rank %ini
      dline @rank 1
      filter -cnteu 2 61 @rank @newrank
      filter -cnteu 2 61 @rank @rank
      filter -c @rank @rank $+(*,$nick,*)
      %rank = $gettok($line(@rank,1),1,32)
      filter -cr $+($calc(%rank -5),-,$calc(%rank +5)) @newrank @rank
      msg $chan rank inbetweens $read(@rank) GGRRGTbrrbRBTREGRG error
    }
  }
  %rank = null
}
on *:text:!alltimerank*:%channel: {
  if ($0 = 1) {
    window @rank
    loadbuf -t @rank Leaderboard.ini
    dline @rank 1
    filter -cnteu 2 61 @rank @rank
    filter -c @rank @rank $+(*,$nick,*)
    %rank = $gettok($line(@rank,1),1,32)
    window -c @rank
    msg $chan $nick is %rank on the leaderboard for all time %points
  }
  else if ($0 = 2) {
    if ($2 !isnum) {
      window @rank
      loadbuf -t @rank Leaderboard.ini
      dline @rank 1
      filter -cnteu 2 61 @rank @rank
      filter -c @rank @rank $+(*,$2,*)
      %rank = $gettok($line(@rank,1),1,32)
      window -c @rank
      msg $chan $2 is %rank on the leaderboard for all time %points
    }
    else if ($2 isnum) {
      window @rank
      window @newrank
      loadbuf -t @rank Leaderboard.ini
      dline @rank 1
      filter -cnteu 2 61 @rank @newrank
      filter -cnteu 2 61 @rank @rank
      filter -c @rank @rank $+(*,$nick,*)
      %rank = $gettok($line(@rank,1),1,32)
      filter -cr $+($calc(%rank -5),-,$calc(%rank +5)) @newrank @rank
      msg $chan rank inbetweens $read(@rank) GGRRGTbrrbRBTREGRG error
    }
  }
  %rank = null
}
on *:text:!leaderboard:%channel: {
  window @leaderboard
  loadbuf -t @leaderboard %ini
  dline @leaderboard 1
  filter -cteu 2 61 @leaderboard @leaderboard
  msg $chan The top 5 people are: $line(@leaderboard,1) $line(@leaderboard,2) $line(@leaderboard,3) $line(@leaderboard,4) $line(@leaderboard,5)
  window -c @leaderboard
}
on *:text:!alltimeleaderboard:%channel: {
  window @leaderboard
  loadbuf -t @leaderboard Leaderboard.ini
  dline @leaderboard 1
  filter -cteu 2 61 @leaderboard @leaderboard
  msg $chan The top 5 people are: $line(@leaderboard,1) $line(@leaderboard,2) $line(@leaderboard,3) $line(@leaderboard,4) $line(@leaderboard,5)
  window -c @leaderboard
}
on *:text:!daytax:%channel: {
  if ($nick == bananamonkeytaco) {
    %temp = $lines(%ini)
    while (%temp > 1) {
      dec %temp
      writeini -n %ini %points $ini(%ini,1,%temp) $calc($readini(%ini,%points,$ini(%ini,1,%temp))-1)
      if ($readini(%ini,%points,$ini(%ini,1,%temp)) < 1) {
        remini -n %ini %points $ini(%ini,1,%temp)
      }
    }
    %temp = $lines(Leaderboard.ini)
    while (%temp > 1) {
      dec %temp
      writeini -n Leaderboard.ini %points $ini(Leaderboard.ini,1,%temp) $calc($readini(Leaderboard.ini,%points,$ini(Leaderboard.ini,1,%temp))-1)
      if ($readini(Leaderboard.ini,%points,$ini(Leaderboard.ini,1,%temp)) < 1) {
        remini -n Leaderboard.ini %points $ini(Leaderboard.ini,1,%temp)
      }
    }
  }
}
on *:text:!sr*:%channel: {
  timersong 1 10 msg $chan !sr $2-
  msg $chan Redeeming a SongRequest for $nick at the cost of 20 %points
  writeini -n %ini %points $nick $calc($readini(%ini,%points,$nick)-20)
}
on *:text:!songrequest*:%channel: {
  timersong 1 10 msg $chan !sr $2-
  msg $chan Redeeming a SongRequest for $nick at the cost of 20 %points
  writeini -n %ini %points $nick $calc($readini(%ini,%points,$nick)-20)
}
on *:text:!discordreward:%channel: {
  if ($readini(%ini,%points,$nick) >= 300) {
    msg $chan /w $nick Use this link to join the discord: https://discord.gg/xC7zc6n Also make sure to say in the chat when you join so my master can allow you to speak in the Discord. Also note that I am not able to respond in any way
  }
  else {
    msg $chan I'm sorry, but you do not have the 300 %points needed to redeem this reward.
  }
}
on *:text:*nowabot*:%channel: {
  msg $chan Did someone say something about my dad?
}
on *:text:*moobot*:%channel: {
  msg $chan Did someone say moobot? Do you think I'm moobot? Are you trying to imply that I'm similar to that useless, filthy, garbage bot? How dare you.
}
on *:text:!yonder:%channel: {
  msg $chan ...
}
on *:text:!set:#bananamonkeytaco: {
  set %channel #bananamonkeytaco
  set %points Bananas
  set %ini $+(%points,.ini)
}
on *:text:something:#bananamonkeytaco: {
  msg $chan %channel
  msg $chan %ini
}
on *:text:*:#: {
  return
}
on *:text:youcannotsaythiseversecretlostcoding:#: {
  else if ($1 == !dst) {
    if ($nick isop #bananamonkeytaco) {
      if ($2 == add) {
        %players = $addtok($3,%players,44)
        msg $chan $3 has been added to the current players
      }
      else if ($2 == del) {
        if ($findtok(%players,$3,44) != 0) {
          %players = $remtok(%players,$3,0,44)
          msg $chan $3 has been removed from the players.
        }
        else {
          msg $chan $3 is not in the player list. Please check the list for the correct player you wish to remove
        }
        else if ($2 == reset) {
          %players = $deltok(%players,1-,44)
          msg $chan Players have been reset.
        }
      }
      if ($0 == 1) {
        if ($numtok(%players,44) == 0) {
          msg $chan There are no players for DST at the moment.
        }
        else if ($numtok(%players,44) > 0) {
          msg $chan The current players for DST are %players
        }
      }
      else if ($2 == buy) {
        if ($numtok(%players,44) == 6) {
          msg $chan I'm sorry, there are 6 players already which is the maxium. If still wish to play you may try and buy out a player.
        }
        else if ($0 == 3 && $numtok(%players,44) == 0) {
          msg $chan $nick is attempting to buy out $3 from the DST server. They will have 5 minutes to respond or they will be replaced.
          writeini -n Bananas.ini Bananas $nick $calc($readini(Bananas.ini,Bananas,$nick)-200)
          timerreplace 1 300 $replacePlayer $nick $3
        }
        else {
          msg $chan $nick has bought into the DST server for 100 bananas and has been added to the player list.
          %players = $addtok($3,%players,44)
          writeini -n Bananas.ini Bananas $nick $calc($readini(Bananas.ini,Bananas,$nick)-100)
        }
      }
    }
  }
}
on $*:text:/^(!sr*|!songrequest*)/si:#: {
  timersong 1 10 msg $chan !songrequest $2-
  msg $chan Redeeming a SongRequest for $nick at the cost of 20 bananas.
  writeini -n Bananas.ini Bananas $nick $calc($readini(Bananas.ini,Bananas,$nick)-20)
}
